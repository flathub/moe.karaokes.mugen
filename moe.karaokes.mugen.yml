app-id: moe.karaokes.mugen
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '25.08'
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node24
command: km-wrapper
separate-locales: false
finish-args:
  - --filesystem=~/KaraokeMugen:create
  - --filesystem=xdg-run/app/com.discordapp.Discord:create
  - --filesystem=xdg-run/app/com.discordapp.DiscordCanary:create
  - --share=ipc
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --socket=wayland
  - --device=all
  - --own-name=org.mpris.MediaPlayer2.KaraokeMugen.*
  - --talk-name=org.gnome.SessionManager
  - --share=network
  - --system-talk-name=org.freedesktop.UPower
  - --talk-name=com.canonical.AppMenu.Registrar
  - --talk-name=com.canonical.dbusmenu
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher
  - --env=LC_NUMERIC=C
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons
cleanup:
  - '*.la'
  - '*.a'
modules:
  - name: parse-yapp
    buildsystem: simple
    build-commands:
      - perl Makefile.PL INSTALL_BASE=/app
      - make
      - make install
    sources:
      - type: archive
        url: >-
          https://cpan.metacpan.org/authors/id/W/WB/WBRASWELL/Parse-Yapp-1.21.tar.gz
        sha256: 3810e998308fba2e0f4f26043035032b027ce51ce5c8a52a8b8e340ca65f13e5
  - name: libXmu
    buildsystem: autotools
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/xorg/lib/libxmu.git
        tag: libXmu-1.2.1
        commit: 792f80402ee06ce69bca3a8f2a84295999c3a170
        x-checker-data:
          type: git
          tag-pattern: ^libXmu-([\d.]+)$
  - name: xclip
    buildsystem: autotools
    sources:
      - type: git
        url: https://github.com/astrand/xclip.git
        tag: '0.13'
        commit: 9aa7090c3b8b437c6489edca32ae43d82e0c1281
        x-checker-data:
          type: git
          tag-pattern: ^(\d+\.\d+)$
  - name: libXpresent
    buildsystem: autotools
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/xorg/lib/libxpresent.git
        tag: libXpresent-1.0.2
        commit: 4d92149372461bf575e8a09b1064a2884c38c3aa
        x-checker-data:
          type: git
          tag-pattern: ^libXpresent-([\d.]+)$
  - name: luajit
    no-autogen: true
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share/man
    sources:
      - type: git
        url: https://github.com/LuaJIT/LuaJIT.git
        disable-shallow-clone: true
        commit: 7152e15489d2077cd299ee23e3d51a4c599ab14f
      - type: shell
        commands:
          - sed -i 's|/usr/local|/app|' ./Makefile
  - name: uchardet
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_STATIC=0
      # TODO can be removed when updating to uchardet > 0.0.8
      - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share/man
    sources:
      - type: archive
        url: >-
          https://www.freedesktop.org/software/uchardet/releases/uchardet-0.0.8.tar.xz
        sha256: e97a60cfc00a1c147a674b097bb1422abd9fa78a2d9ce3f3fdcc2e78a34ac5f0
        x-checker-data:
          type: html
          url: https://www.freedesktop.org/software/uchardet/releases/
          version-pattern: uchardet-(\d\.\d+\.?\d*).tar.xz
          url-template: >-
            https://www.freedesktop.org/software/uchardet/releases/uchardet-$version.tar.xz
  - name: libass
    cleanup:
      - /include
      - /lib/pkgconfig
    config-opts:
      - --disable-static
      - --enable-asm
      - --enable-harfbuzz
      - --enable-fontconfig
    sources:
      - type: git
        url: https://github.com/libass/libass.git
        tag: 0.17.4
        commit: bbb3c7f1570a4a021e52683f3fbdf74fe492ae84
        x-checker-data:
          type: git
          tag-pattern: ^(\d\.\d{1,3}\.\d{1,2})$
  - name: libgcrypt
    config-opts:
      - --disable-static
      - --disable-doc
    sources:
      - type: git
        url: https://dev.gnupg.org/source/libgcrypt.git
        tag: libgcrypt-1.10.3
        commit: aa1610866f8e42bdc272584f0a717f32ee050a22
  - name: zimg
    config-opts:
      - --disable-static
    cleanup:
      - /include
      - /lib/pkgconfig
      - /share/doc
    sources:
      - type: archive
        archive-type: tar
        url: https://api.github.com/repos/sekrit-twc/zimg/tarball/release-3.0.6
        sha256: 15140e491c4ce9db5f02a038d8a1eb53e9151b55eeed06a2899425a6ebfef367
        x-checker-data:
          type: json
          url: https://api.github.com/repos/sekrit-twc/zimg/releases/latest
          url-query: .tarball_url
          version-query: .tag_name | sub("^release-"; "")
          timestamp-query: .published_at
  - name: Tesseract
    config-opts:
      - --disable-static
    modules:
      - name: Leptonica
        config-opts:
          - --disable-static
          - --with-pic
        sources:
          - type: archive
            url: http://www.leptonica.org/source/leptonica-1.87.0.tar.gz
            sha256: c73363397f96eb1295602bf44d708a994ad42046c791bf03ea0505d829bdb6a7
            x-checker-data:
              type: anitya
              project-id: 1549
              stable-only: true
              url-template: http://www.leptonica.org/source/leptonica-$version.tar.gz
        cleanup:
          - /bin
    sources:
      - type: git
        url: https://github.com/tesseract-ocr/tesseract.git
        tag: 5.5.2
        commit: 6e1d56a847e697de07b38619356550e5cf4e8633
        x-checker-data:
          type: json
          url: https://api.github.com/repos/tesseract-ocr/tesseract/releases/latest
          timestamp-query: .published_at
          tag-query: .tag_name
          version-query: .tag_name
    cleanup:
      - /bin
  - name: ImageMagick
    config-opts:
      - --disable-static
      - --disable-docs
      - --with-hdri
      - --with-pic
    sources:
      - type: archive
        url: https://github.com/ImageMagick/ImageMagick/archive/7.1.2-12.tar.gz
        sha256: 521fa7a8c0f664a3f5cf7437cbcc219f12bd6d5fe0c1fb014f212fa145076e60
        x-checker-data:
          type: anitya
          project-id: 1372
          stable-only: true
          url-template: https://github.com/ImageMagick/ImageMagick/archive/$version.tar.gz
    cleanup:
      - /bin
      - /etc
      - /lib/ImageMagick*
      - /share/ImageMagick*
  - name: rubberband
    buildsystem: meson
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: git
        url: https://github.com/breakfastquay/rubberband.git
        tag: v4.0.0
        commit: 1d95888bec3ae0a17c0c4af791810d5a63f6bc35
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
  - name: mujs
    buildsystem: autotools
    no-autogen: true
    make-args:
      - release
    make-install-args:
      - prefix=/app
      - install-shared
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
    sources:
      - type: git
        url: https://codeberg.org/ccxvii/mujs.git
        tag: 1.3.8
        commit: 307f18c4216420f2f56e22d8e7040baa39a6304a
        x-checker-data:
          type: git
          url: https://codeberg.org/api/v1/repos/ccxvii/mujs/tags
          tag-pattern: ^([\d.]+)$
  - name: nv-codec-headers
    cleanup:
      - '*'
    no-autogen: true
    make-install-args:
      - PREFIX=/app
    sources:
      - type: git
        url: https://github.com/FFmpeg/nv-codec-headers.git
        tag: n13.0.19.0
        commit: e844e5b26f46bb77479f063029595293aa8f812d
        x-checker-data:
          type: git
          tag-pattern: ^n([\d.]+)$
  - name: x264
    cleanup:
      - /include
      - /lib/pkgconfig
      - /share/man
    config-opts:
      - --disable-cli
      - --enable-shared
    sources:
      - type: git
        url: https://github.com/mirror/x264.git
        commit: 31e19f92f00c7003fa115047ce50978bc98c3a0d
  - name: x265
    buildsystem: cmake
    subdir: source
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_STATIC=0
      # TODO can be removed when updating to x265 > 4.1
      - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
    cleanup:
      - /include
      - /lib/pkgconfig
      - /share/man
    sources:
      - type: git
        url: https://bitbucket.org/multicoreware/x265_git.git
        tag: '4.0'
        commit: 6318f223684118a2c71f67f3f4633a9e35046b00
      # fix cmake build issue
      # https://bitbucket.org/multicoreware/x265_git/commits/b354c009a60bcd6d7fc04014e200a1ee9c45c167
      - type: patch
        path: patches/x265-cmake_policy.patch
  - name: libmysofa
    buildsystem: cmake
    config-opts:
      - -DBUILD_TESTS=OFF
    sources:
      - type: git
        commit: 444d2c1d7ececf5cc2d96d3b17b209047b02318d
        tag: v1.3.3
        url: https://github.com/hoene/libmysofa.git
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
  - name: libbs2b
    buildsystem: autotools
    config-opts:
      - --disable-static
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: archive
        archive-type: tar
        url: >-
          https://downloads.sourceforge.net/sourceforge/bs2b/libbs2b-3.1.0.tar.gz
        sha256: 6aaafd81aae3898ee40148dd1349aab348db9bfae9767d0e66e0b07ddd4b2528
        x-checker-data:
          type: html
          url: https://sourceforge.net/projects/bs2b/files/libbs2b/
          version-pattern: projects/bs2b/files/libbs2b/(\d+\.\d+\.\d+)
          url-template: >-
            https://downloads.sourceforge.net/sourceforge/bs2b/libbs2b-$version.tar.gz
      - type: shell
        commands:
          - sed -i -e 's/lzma/xz/g' configure.ac
          - autoreconf -vif
  - name: ffmpeg
    cleanup:
      - /include
      - /lib/pkgconfig
      - /share/ffmpeg/examples
    config-opts:
      - --disable-debug
      - --disable-doc
      - --disable-static
      - --enable-encoder=png
      - --enable-gnutls
      - --enable-gpl
      - --enable-shared
      - --enable-version3
      - --enable-libaom
      - --enable-libass
      - --enable-libbs2b
      - --enable-libdav1d
      - --enable-libfreetype
      - --enable-libmp3lame
      - --enable-libopus
      - --enable-libjxl
      - --enable-libmysofa
      - --enable-libtheora
      - --enable-libvorbis
      - --enable-libvpx
      - --enable-libx264
      - --enable-libx265
      - --enable-libwebp
      - --enable-libxml2
      - --enable-vulkan
      - --enable-libdrm
      - --enable-vaapi
    post-install:
      - install -d /app/km
      - install -d /app/km/app/
      - install -d /app/km/app/bin
      - mv /app/bin/ffmpeg /app/km/app/bin/ffmpeg
    sources:
      - type: git
        url: https://github.com/FFmpeg/FFmpeg.git
        commit: 894da5ca7d742e4429ffb2af534fcda0103ef593
        tag: n8.0.1
        x-checker-data:
          type: git
          tag-pattern: ^n([\d.]{3,7})$
  - name: libsixel
    buildsystem: meson
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: archive
        archive-type: tar
        url: >-
          https://api.github.com/repos/libsixel/libsixel/tarball/refs/tags/v1.10.5
        sha256: 402da9e24caea62fe1e4c5d6f9c9211141f7a5d8016e717527ecde10c5522344
        x-checker-data:
          type: json
          url: https://api.github.com/repos/libsixel/libsixel/tags
          url-query: .[0].tarball_url
          version-query: .[0].name
  - name: vapoursynth
    config-opts:
      - --with-python-prefix=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/vapoursynth/vapoursynth/archive/72.tar.gz
        sha256: f8fcc5e2e9d2195454310e3356ea13e5334125891e452cc6543e985f28cacd22
        x-checker-data:
          type: anitya
          project-id: 15982
          stable-only: true
          url-template: https://github.com/vapoursynth/vapoursynth/archive/$version.tar.gz
  - name: libplacebo
    buildsystem: meson
    config-opts:
      - -Dvulkan=enabled
      - -Dshaderc=enabled
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: git
        url: https://github.com/haasn/libplacebo.git
        tag: v7.351.0
        commit: 3188549fba13bbdf3a5a98de2a38c2e71f04e21e
      # fix python error: TypeError: expected an Element, not ElementTree
      # https://code.videolan.org/videolan/libplacebo/-/commit/12509c0f1ee8c22ae163017f0a5e7b8a9d983a17
      - type: patch
        path: patches/libplacebo-vulkan-utils_gen-python.patch
  - name: hwdata
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/vcrhonek/hwdata/archive/refs/tags/v0.394.tar.gz
        sha256: b7c3fd7214a3b7c49d2661db127a712dc11cffd1799f793947aa1cb20aaf3298
  - name: libdisplay-info
    buildsystem: meson
    sources:
      - type: archive
        url: >-
          https://gitlab.freedesktop.org/emersion/libdisplay-info/-/archive/0.2.0/libdisplay-info-0.2.0.tar.gz
        sha256: f7331fcaf5527251b84c8fb84238d06cd2f458422ce950c80e86c72927aa8c2b
  - name: mpv
    buildsystem: meson
    config-opts:
      - -Dalsa=enabled
      - -Dbuild-date=false
      - -Dcdda=disabled
      - -Dcplayer=true
      - -Dcplugins=enabled
      - -Dcuda-hwaccel=enabled
      - -Dcuda-interop=enabled
      - -Ddmabuf-wayland=enabled
      - -Ddrm=enabled
      - -Ddvbin=disabled
      - -Ddvdnav=disabled
      - -Degl-drm=enabled
      - -Degl-wayland=enabled
      - -Degl-x11=enabled
      - -Degl=enabled
      - -Dgbm=enabled
      - -Dgl-x11=enabled
      - -Dgl=enabled
      - -Diconv=enabled
      - -Djack=enabled
      - -Djavascript=enabled
      - -Djpeg=enabled
      - -Dlcms2=enabled
      - -Dlibarchive=enabled
      - -Dlibavdevice=enabled
      - -Dlibbluray=disabled
      - -Dlibmpv=true
      - -Dlua=enabled
      - -Dopenal=enabled
      - -Dpipewire=enabled
      - -Dplain-gl=enabled
      - -Dpulse=enabled
      - -Drubberband=enabled
      # - -Dsdl2-audio=enabled
      # - -Dsdl2-gamepad=enabled
      # - -Dsdl2-video=enabled
      # - -Dsdl2=enabled
      - -Duchardet=enabled
      - -Dvaapi-drm=enabled
      - -Dvaapi-wayland=enabled
      - -Dvaapi-x11=enabled
      - -Dvaapi=enabled
      - -Dvapoursynth=enabled
      - -Dvdpau-gl-x11=enabled
      - -Dvdpau=enabled
      - -Dvector=enabled
      - -Dvulkan=enabled
      - -Dwayland=enabled
      - -Dwerror=false
      - -Dx11=enabled
      - -Dxv=enabled
      - -Dzimg=enabled
      - -Dzlib=enabled
    cleanup:
      - /include
      - /lib/pkgconfig
    post-install:
      - install -d /app/km
      - install -d /app/km/app/
      - install -d /app/km/app/bin
      - mv /app/bin/mpv /app/km/app/bin/mpv
    sources:
      - type: git
        url: https://github.com/mpv-player/mpv.git
        tag: v0.41.0
        commit: 41f6a645068483470267271e1d09966ca3b9f413
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
  - name: ed
    build-options:
      no-debuginfo: true
    buildsystem: autotools
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/ed/ed-1.22.4.tar.lz
        mirror-urls:
          - https://mirrors.kernel.org/gnu/ed/ed-1.20.1.tar.lz
          - https://mirrors.ocf.berkeley.edu/gnu/ed/ed-1.20.1.tar.lz
          - https://ftpmirror.gnu.org/gnu/ed/ed-1.20.1.tar.lz
        sha256: 987a1ebbbad3fcf63a1ffa9e29b3fa7de065150d16319d0a49dd8b57f81d3e9c
        x-checker-data:
          type: html
          url: https://ftp.gnu.org/gnu/ed/
          version-pattern: ed-(\d\.\d+\.?\d*).tar.lz
          url-template: https://ftp.gnu.org/gnu/ed/ed-$version.tar.lz
  - name: bc
    build-options:
      no-debuginfo: true
    buildsystem: autotools
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/bc/bc-1.08.2.tar.gz
        mirror-urls:
          - https://mirrors.kernel.org/gnu/bc/bc-1.07.1.tar.gz
          - https://mirrors.ocf.berkeley.edu/gnu/bc/bc-1.07.1.tar.gz
          - https://ftpmirror.gnu.org/gnu/bc/bc-1.07.1.tar.gz
        sha256: ae470fec429775653e042015edc928d07c8c3b2fc59765172a330d3d87785f86
        x-checker-data:
          type: html
          url: https://ftp.gnu.org/gnu/bc/
          version-pattern: bc-(\d\.\d+\.?\d*).tar.gz
          url-template: https://ftp.gnu.org/gnu/bc/bc-$version.tar.gz
  - name: python_dateutil
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app six*.whl python_dateutil*.whl
    sources:
    # install six to fix https://github.com/dateutil/dateutil/issues/1430
      - type: file
        url: https://files.pythonhosted.org/packages/b7/ce/149a00dd41f10bc29e5921b496af8b574d8413afcd5e30dfa0ed46c2cc5e/six-1.17.0-py2.py3-none-any.whl
        sha256: 4721f391ed90541fddacab5acf947aa0d3dc7d27b2e1e8eda2be8970586c3274
        x-checker-data:
          type: pypi
          name: six
          packagetype: bdist_wheel
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/ec/57/56b9bcc3c9c6a792fcbaf139543cee77261f3651ca9da0c93f5c1221264b/python_dateutil-2.9.0.post0-py2.py3-none-any.whl
        sha256: a8b2bc7bffae282281c8140a97d3aa9c14da0b136dfe83f850eea9a5f7470427
        x-checker-data:
          type: pypi
          name: python_dateutil
          packagetype: bdist_wheel
  - name: urllib3
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app urllib3*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/33/cf/8435d5a7159e2a9c83a95896ed596f68cf798005fe107cc655b5c5c14704/urllib3-1.26.20-py2.py3-none-any.whl
        sha256: 0ed14ccfbf1c30a9072c7ca157e4319b70d65f623e91e7b32fadb2853431016e
        x-checker-data:
          versions:
            '>=': 1.21.1
            <: '1.27'
          type: pypi
          name: urllib3
          packagetype: bdist_wheel
  - name: soupsieve
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app soupsieve*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/48/f3/b67d6ea49ca9154453b6d70b34ea22f3996b9fa55da105a79d8732227adc/soupsieve-2.8.1-py3-none-any.whl
        sha256: a11fe2a6f3d76ab3cf2de04eb339c1be5b506a8a47f2ceb6d139803177f85434
        x-checker-data:
          type: pypi
          name: soupsieve
          packagetype: bdist_wheel
  - name: rebulk
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app rebulk-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/84/4d/df073d593f7e7e4a5a7e19148b2e9b4ae63b4ddcbb863f1e7bb2b6f19c62/rebulk-3.2.0-py3-none-any.whl
        sha256: 6bc31ae4b37200623c5827d2f539f9ec3e52b50431322dad8154642a39b0a53e
        x-checker-data:
          type: pypi
          name: rebulk
          packagetype: bdist_wheel
  - name: pbr
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app pbr-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/c0/db/61efa0d08a99f897ef98256b03e563092d36cc38dc4ebe4a85020fe40b31/pbr-7.0.3-py2.py3-none-any.whl
        sha256: ff223894eb1cd271a98076b13d3badff3bb36c424074d26334cd25aebeecea6b
        x-checker-data:
          type: pypi
          name: pbr
          packagetype: bdist_wheel
  - name: idna
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app idna-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/0e/61/66938bbb5fc52dbdf84594873d5b51fb1f7c7794e9c0f5bd885f30bc507b/idna-3.11-py3-none-any.whl
        sha256: 771a87f49d9defaf64091e6e6fe9c18d4833f140bd19464795bc32d966ca37ea
        x-checker-data:
          type: pypi
          name: idna
          packagetype: bdist_wheel
  - name: decorator
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app decorator-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/4e/8c/f3147f5c4b73e7550fe5f9352eaa956ae838d5c51eb58e7a25b9f3e2643b/decorator-5.2.1-py3-none-any.whl
        sha256: d316bb415a2d9e2d2b3abcc4084c6502fc09240e292cd76a76afc106a1c8e04a
        x-checker-data:
          type: pypi
          name: decorator
          packagetype: bdist_wheel
  - name: charset_normalizer
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app charset_normalizer-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/0a/4c/925909008ed5a988ccbb72dcc897407e5d6d3bd72410d69e051fc0c14647/charset_normalizer-3.4.4-py3-none-any.whl
        sha256: 7a32c560861a02ff789ad905a2fe94e3f840803362c84fecf1851cb4cf3dc37f
        x-checker-data:
          type: pypi
          name: charset_normalizer
          packagetype: bdist_wheel
  - name: certifi
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app certifi-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/e6/ad/3cc14f097111b4de0040c83a525973216457bbeeb63739ef1ed275c1c021/certifi-2026.1.4-py3-none-any.whl
        sha256: 9943707519e4add1115f44c2bc244f782c0249876bf51b6599fee1ffbedd685c
        x-checker-data:
          type: pypi
          name: certifi
          packagetype: bdist_wheel
  - name: stevedore
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app stevedore-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/f4/40/8561ce06dc46fd17242c7724ab25b257a2ac1b35f4ebf551b40ce6105cfa/stevedore-5.6.0-py3-none-any.whl
        sha256: 4a36dccefd7aeea0c70135526cecb7766c4c84c473b1af68db23d541b6dc1820
        x-checker-data:
          type: pypi
          name: stevedore
          packagetype: bdist_wheel
  - name: requests
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app requests-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/1e/db/4254e3eabe8020b458f1a747140d32277ec7a271daf1d235b70dc0b4e6e3/requests-2.32.5-py3-none-any.whl
        sha256: 2462f94637a34fd532264295e186976db0f5d453d1cdd31473c85a6a161affb6
        x-checker-data:
          type: pypi
          name: requests
          packagetype: bdist_wheel
  - name: rarfile
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app rarfile-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/62/fc/ab37559419ca36dd8dd317c3a98395ed4dcee2beeb28bf6059b972906727/rarfile-4.2-py3-none-any.whl
        sha256: 8757e1e3757e32962e229cab2432efc1f15f210823cc96ccba0f6a39d17370c9
        x-checker-data:
          type: pypi
          name: rarfile
          packagetype: bdist_wheel
  - name: pytz
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app pytz-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/81/c4/34e93fe5f5429d7570ec1fa436f1986fb1f00c3e0f43a589fe2bbcd22c3f/pytz-2025.2-py2.py3-none-any.whl
        sha256: 5ddf76296dd8c44c26eb8f4b6f35488f3ccbf6fbbd7adee0b7262d43f0ec2f00
        x-checker-data:
          type: pypi
          name: pytz
          packagetype: bdist_wheel
  - name: pysrt
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=/app --root=/
    sources:
      - type: archive
        url: >-
          https://files.pythonhosted.org/packages/31/1a/0d858da1c6622dcf16011235a2639b0a01a49cecf812f8ab03308ab4de37/pysrt-1.1.2.tar.gz
        sha256: b4f844ba33e4e7743e9db746492f3a193dc0bc112b153914698e7c1cdeb9b0b9
        x-checker-data:
          type: pypi
          name: pysrt
  - name: babelfish
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app babelfish-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/95/a1/bd4f759db13cd8beb9c9f68682aced5d966781b9d7380cf514a306f56762/babelfish-0.6.1-py3-none-any.whl
        sha256: 512f1501d4c8f7d38f0921f48660be7542de1a7b24abb6a6a65324a670150293
        x-checker-data:
          type: pypi
          name: babelfish
          packagetype: bdist_wheel
  - name: guessit
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app guessit-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/b8/9b/924a8f9709c3143d4c9a301a88042cbce37e09789378217284b19d4f8132/guessit-3.8.0-py3-none-any.whl
        sha256: eb5747b1d0fbca926562c1e5894dbc3f6507c35e8c0bd9e38148401cd9579d83
        x-checker-data:
          type: pypi
          name: guessit
          packagetype: bdist_wheel
  - name: enzyme
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app enzyme-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/67/bc/be0fbce0eb198f4361f462520122151b0ec347ecaeb5d349cf36ae0ac751/enzyme-0.5.2-py3-none-any.whl
        sha256: 5a85306c136368d78f299bb74bf0c5f5d37e2689adc5caec5aba5ee2f029296b
        x-checker-data:
          type: pypi
          name: enzyme
          packagetype: bdist_wheel
  - name: typing-extensions
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app typing*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/18/67/36e9267722cc04a6b9f15c7f3441c2363321a3ea07da7ae0c0707beb2a9c/typing_extensions-4.15.0-py3-none-any.whl
        sha256: f0fa19c6845758ab08074a0cfa8b7aecb71c999ca73d62883bc25cc018c4e548
        x-checker-data:
          type: pypi
          name: typing-extensions
          packagetype: bdist_wheel
  - name: dogpile
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app dogpile*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/dc/80/12235e5b75bb2c586733280854f131b86051e0bbdfb55349ff70d0f72cf9/dogpile_cache-1.5.0-py3-none-any.whl
        sha256: dc7b47d37844db15e8fdc0243c1b58857a2ddc52a5118237a97127bac200e18d
        x-checker-data:
          type: pypi
          name: dogpile.cache
          packagetype: bdist_wheel
  - name: click
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app click-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/98/78/01c019cdb5d6498122777c1a43056ebb3ebfeef2076d9d026bfe15583b2b/click-8.3.1-py3-none-any.whl
        sha256: 981153a64e25f12d547d3426c367a4857371575ee7ad18df2a6183ab0545b2a6
        x-checker-data:
          type: pypi
          name: click
          packagetype: bdist_wheel
  - name: chardet
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app chardet-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/38/6f/f5fbc992a329ee4e0f288c1fe0e2ad9485ed064cac731ed2fe47dcc38cbf/chardet-5.2.0-py3-none-any.whl
        sha256: e1cf59446890a00105fe7b7912492ea04b6e6f06d4b742b2c788469e34c82970
        x-checker-data:
          type: pypi
          name: chardet
          packagetype: bdist_wheel
  - name: beautifulsoup4
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app beautifulsoup4-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/1a/39/47f9197bdd44df24d67ac8893641e16f386c984a0619ef2ee4c51fbbc019/beautifulsoup4-4.14.3-py3-none-any.whl
        sha256: 0918bfe44902e6ad8d57732ba310582e98da931428d231a5ecb9e7c703a735bb
        x-checker-data:
          type: pypi
          name: beautifulsoup4
          packagetype: bdist_wheel
  - name: appdirs
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app appdirs-*.whl
    sources:
      - type: file
        url: >-
          https://files.pythonhosted.org/packages/3b/00/2344469e2084fb287c2e0b57b72910309874c3245463acd6cf5e3db69324/appdirs-1.4.4-py2.py3-none-any.whl
        sha256: a841dacd6b99318a741b166adb07e19ee71a274450e68237b4650ca1055ab128
        x-checker-data:
          type: pypi
          name: appdirs
          packagetype: bdist_wheel
  - name: mpv_inhibit_gnome
    buildsystem: simple
    build-commands:
      - make
      - install -D lib/mpv_inhibit_gnome.so /app/etc/mpv/scripts
    sources:
      - type: git
        url: https://github.com/Guldoman/mpv_inhibit_gnome.git
        tag: v0.1.3
        commit: 9069be0f15fa2c222d78a183d4aa1477d8a8f2cd
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
  - name: patch
    buildsystem: simple
    build-options:
      no-debuginfo: true
    build-commands:
      - ./bootstrap
      - ./configure
      - make
      - install -d /app/km
      - install -d /app/km/app/
      - install -d /app/km/app/bin
      - mv src/patch /app/km/app/bin/patch
    sources:
      - type: git
        url: https://git.savannah.gnu.org/git/patch.git
        commit: 48ceda8200aaf30c3ce42c31cd70ff6087db2425
        tag: v2.8
  - name: postgres
    buildsystem: simple
    build-options:
      no-debuginfo: true
    build-commands:
      - ./configure --prefix=/app/km/app/bin/postgres
      - make
      - make install
      - cd contrib ; make ; make install
      - ls /app/km/app/bin/postgres/share/extension/
      - rm -Rf /app/km/app/bin/postgres/include
    sources:
      - type: git
        url: https://git.postgresql.org/git/postgresql.git
        commit: 4b324845ba5d24682b9b3708a769f00d160afbd7
        tag: REL_18_1
  - name: karaokemugen
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/node24/bin
      env:
        XDG_CACHE_HOME: /run/build/karaokemugen/flatpak-node/cache
        npm_config_nodedir: /usr/lib/sdk/node24
        YARN_GLOBAL_FOLDER: /run/build/karaokemugen/flatpak-node/yarn-mirror/global
        YARN_ENABLE_INLINE_BUILDS: '1'
        YARN_ENABLE_TELEMETRY: '0'
        YARN_ENABLE_NETWORK: '0'
        YARN_ENABLE_GLOBAL_CACHE: '0'
    build-commands:
      - >-
        install -D sentry-cli-Linux-$(gcc -dumpmachine | awk -F- {'print
        $1'}) /app/bin/sentry-cli
      - install -d v8.14.5/
      - sed -i 's/\"karaokemugen-app\"/\"moe.karaokes.mugen\"/g' package.json
      - >-
        sed --in-place 's/configuration.get(`lockfileFilename`)/"yarn.lock"/g'
        $FLATPAK_BUILDER_BUILDDIR/flatpak-node/flatpak-yarn.js
      - >-
        yarn plugin import
        $FLATPAK_BUILDER_BUILDDIR/flatpak-node/flatpak-yarn.js
      - yarn convertToZip $(which yarn)
      - SENTRYCLI_USE_LOCAL=1 yarn install
      - yarn remove corepack
      - yarn build
      - yarn installkmfrontend
      - NODE_OPTIONS=--openssl-legacy-provider yarn buildkmfrontend
      - git rev-parse HEAD | head -c 8 > assets/sha.txt
      - >-
        . flatpak-node/electron-builder-arch-args.sh; npx electron-builder --dir
        -c.compression=store -c.mac.identity=null $ELECTRON_BUILDER_ARCH_ARGS
      - cp -r packages/linux*unpacked/* /app/km/
      - install -d /app/km/app/
      - install -d /app/km/app/bin
      - install -Dm755 stub_sandbox /app/km/chrome-sandbox
      - install -Dm755 km-wrapper /app/bin/km-wrapper
      - install -d /app/share/applications
      - >-
        install -Dm644 moe.karaokes.mugen.desktop
        "/app/share/applications/${FLATPAK_ID}.desktop"
      - >-
        install -Dm644 build/icon512.png
        "/app/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png"
      - >-
        install -Dm644 moe.karaokes.mugen.metainfo.xml
        /app/share/metainfo/${FLATPAK_ID}.metainfo.xml
    sources:
      - type: git
        url: https://gitlab.com/karaokemugen/code/karaokemugen-app
        commit: 7c41b49a866f70cdbd12ba0c88af1261b6c1d090
        tag: 9.0.2
      - generated-sources.json
      - type: script
        dest-filename: stub_sandbox
        commands:
          - |
            echo Stub sandbox ignoring command: $@
            exit 1
      - type: file
        path: km-wrapper
      - type: file
        path: moe.karaokes.mugen.metainfo.xml
      - type: file
        path: moe.karaokes.mugen.desktop
      - type: file
        url: >-
          https://downloads.sentry-cdn.com/sentry-cli/2.58.4/sentry-cli-Linux-x86_64
        sha256: a4932b4315b192b3d037678a16eb2a5a8731609f671fc4008e643b85c3c74cb6
        only-arches:
          - x86_64
      - type: file
        url: >-
          https://downloads.sentry-cdn.com/sentry-cli/2.58.4/sentry-cli-Linux-aarch64
        sha256: 672cb986b0c5d84ef724f39b3aa189be802bceb8bc7dc8c5776a0ca90fcf41bd
        only-arches:
          - aarch64
